
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>RumbleSan Heavy Noise Industries</title>
  <meta name="author" content="guy">

  
  <meta name="description" content="And now I come to the final entry in my month of patching. It’s been loads of fun but felt a little bit gruelling at some points if I’m honest. I’ve  &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://rumblesan.com/blog/page/8/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="RumbleSan Heavy Noise Industries" type="application/atom+xml">
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
    });
</script>
<script type="text/javascript"
  src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


<!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-19842221-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">RumbleSan Heavy Noise Industries</a></h1>
  
    <h2>Noise with weight</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:rumblesan.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Home</a></li>
  <li><a href="/about">About</a></li>
  <li><a href="http://patchwerk.rumblesan.com">PatchWerk</a></li>
  <li><a href="http://rumblesan.tumblr.com">Glitchr</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/11/30/patch-a-day-month-day-30-audio-fractals/">Patch-a-Day Month Day 30: Audio Fractals</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-11-30T22:25:14+00:00" pubdate data-updated="true">Nov 30<span>th</span>, 2010</time>
        
         | <a href="/blog/2010/11/30/patch-a-day-month-day-30-audio-fractals/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>And now I come to the final entry in my month of patching. It’s been loads of fun but felt a little bit gruelling at some points if I’m honest. I’ve definitely learnt a huge amount in the last thirty days and my knowledge of Pure Data has improved hugely. I’ll not be surprised if I do this again at some point next year.</p>

<p>Anyway, tonight’s patch follows on in some ways from last night, but also has much to do with my thinking about the Mandlebrot set over the last couple of days. This is more like tentative exploration and philosophising than lessons or patches but it may prove interesting and useful to some.</p>

<p>When I looked further in to how people have used fractals in music, it seems that much of it involved taking the equations used to calculate the Mandlebrot set and then mapping these values to frequencies. I can see the logic in this and I’m sure it can be used to create some very interesting patterns but it felt a little detached to me insomuch as the maths and the audio aren’t specifically related, just manually joined. When I started thinking more about what I felt a fractal to be I realised that, at it’s core, it is just a structure that has great complexity and comes from feeding the result of an operation back into itself. Iterating in this way is what produces the end results, so I decided to apply this idea to sound.</p>

<p>The result of the first try was this patch.</p>

<p><img src="/a/2010-11-30-patch-a-day-month-day-30-audio-fractals/30-AudioFractal1.png" alt="A patch to try and create an audio fractal" /></p>

<p>A simple FM synth with the output being fed back into the input through a long delay was the starting point I chose. The output is multiplied to get it into a greater range and then used to modulate the initial frequency, the idea being that the system will iterate through this process, possibly arriving at an interesting tone, possibly just carrying creating interesting patterns. I haven’t explored this as far as I would like but I feel that the possibilities of finding something surprising are high.</p>

<p>I made two extensions to this, after finding that manually playing with the frequency parameter to generate a quickly changing frequency created more chaotic patterns as it fed back. I also tried playing with the delay size but found that this gave less interesting results.</p>

<p><img src="/a/2010-11-30-patch-a-day-month-day-30-audio-fractals/30-AudioFractal2.png" alt="An extension to the audio fractal patch" /></p>

<p>The final extension was to have the original frequency control for the synth be removed after the random tones had been put into the system meaning that the whole thing was running just off the first sounds. This seems to make the output take a bit longer before it turns into a constant drone sound. The examples that I found all eventually become a fairly constant sound but there is quite a bit of movement within it. I don’t know if this really qualifies it as the self similarity that you might look for in a fractal but it is interesting to hear the points of equilibrium.</p>

<p><img src="/a/2010-11-30-patch-a-day-month-day-30-audio-fractals/30-AudioFractal3.png" alt="Final extension to original audio fractal patch" /></p>

<p>I want to keep exploring the possibilities here. I’m sure that with a bit more tweaking and experimenting this pretty basic patch will turn up some interesting results. I’m going to be building more patches like this, trying to find a good balance between simplicity of the patch and complexity required to make the sort of sounds I’m hoping for. This will definitely be an ongoing thing.</p>

<p>The patches are available and I recommend having a play with them.</p>

<p><a href="/a/2010-11-30-patch-a-day-month-day-30-audio-fractals/30-AudioFractals.zip">Audio Fractal Patches</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/11/29/patch-a-day-month-day-29-a-nice-cup-of-drone/">Patch-a-Day Month Day 29: A Nice Cup of Drone</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-11-29T22:31:22+00:00" pubdate data-updated="true">Nov 29<span>th</span>, 2010</time>
        
         | <a href="/blog/2010/11/29/patch-a-day-month-day-29-a-nice-cup-of-drone/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I continue to wrestle somewhat with the Mandlebrot set but I don’t really feel I’m closer to getting anything useful done with it. As I couldn’t think of anything else of great use to do tonight I had another live coding practise, this time aiming for some interesting drone scapes, which I reckon I managed pretty well. I’m not really sure how much explanation I can give this tonight so I’ll talk a little bit about it and then give you the patch to play with.</p>

<p><img src="/a/2010-11-29-patch-a-day-month-day-29-a-nice-cup-of-drone/29-EveningDrone.png" alt="A drone patch done as live coding practise" /></p>

<p>Much of this is pretty rough and ready, and it’s very clear in the audio that it was clipping in lots of places. The part that helps to keep this all ticking over is the multiple sample and hold sections at the top. A single bang gets slightly delayed a few times to trigger snapshots off the same noise source. The results of this get multiplied and increased to fit into reasonable ranges and then fed to lines. The metro will cause this to trigger every four seconds and help keep things moving.</p>

<p>The squarevoice abstraction is simply a rough and ready square wave patch with a control to change the duty cycle of the wave.</p>

<p><img src="/a/2010-11-29-patch-a-day-month-day-29-a-nice-cup-of-drone/29-SquareVoice.png" alt="A squarewave voice abstraction" /></p>

<p>I also put a volume control inside to make things a little easier.</p>

<p>I’ve literally just taken a few of these and connected them together so that they intermodulate one another. There are a couple of controls for changing the frequency of some of them or the frequency of other oscillators that modulate them. I also put in two delay lines that feed signals that modulate other sections. I actually found that when i started switching parts off by setting frequencies to zero, the delay lines kept making things happen. Listen to the last minute or so of the audio to see what I mean.</p>

<p>Sound sample can be found here if the player doesn’t work.</p>

<p><a href="http://soundcloud.com/tasteforreality/cluster">http://soundcloud.com/tasteforreality/cluster</a></p>

<p>[soundcloud]<a href="http://soundcloud.com/tasteforreality/cluster">http://soundcloud.com/tasteforreality/cluster</a>[/soundcloud]</p>

<p>And the patch is available for those that want it.</p>

<p><a href="/a/2010-11-29-patch-a-day-month-day-29-a-nice-cup-of-drone/29-ChaoticTones.zip">Chaotic Drones patch</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/11/28/patch-a-day-month-day-28-simple-but-useful/">Patch-a-Day Month Day 28: Simple but Useful</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-11-28T23:43:52+00:00" pubdate data-updated="true">Nov 28<span>th</span>, 2010</time>
        
         | <a href="/blog/2010/11/28/patch-a-day-month-day-28-simple-but-useful/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I wanted to do an interesting post about using periodic  the Mandlebrot fractal to create interesting melodies. Unfortunately a combination of time and the “sheer volume of information I was trying to learn in not much time” conspired to mean that I’m not able to do that. I’ll try to get that done soon as well because it looks seriously interesting, (for more info I will point you to <a href="http://claudiusmaximus.goto10.org/cm/">here which has masses of cool stuff</a> which was posted in the Pure Data IRC room on Freenode).</p>

<p>Anyway, since I’m not able to do that tonight and it’s getting late. I’m going to throw together a couple useful little effects with a bit of a run down of how they work. Nothing ground breaking but fairly useful I hope. A basic flanger and a sample and hold controlled filter.</p>

<p>The Sample and Hold filter is a pretty standard piece of kit, used for making all manner of bleepy, bloopy filtery sounds. In combination with a couple of delays there’s plenty of opportunity for making an ungodly noise. This should give a good indication of how to make the Sample and Hold part of the patch from a noise source and a snapshot object. In reality I could just use a rand object and it may be slightly more efficient but I don’t think it makes a major difference.</p>

<p><img src="/a/2010-11-28-patch-a-day-month-day-28-simple-but-useful/28-SandHFilter.png" alt="Sample and Hold Controlled Filter" /></p>

<p>The metro periodically bangs the snapshot and we get our noise sample. This gets scaled to a zero to one range and then the bit of maths to the right means we can choose upper and lower bounds for what frequencies we want it to choose. The chosen frequency gets packed into a list so we can feed it to a line to control the band pass filter.</p>

<p>The variables are all easily changeable, I just chose a noise source so the filtering can be easily heard.</p>

<p>The flanger has a little bit more maths to it in so much as we need to generate a triangle wave to control the delay amount.</p>

<p><img src="/a/2010-11-28-patch-a-day-month-day-28-simple-but-useful/28-Flanger.png" alt="A Flanger Effect" /></p>

<p>By creating a second phasor wave that goes from zero to one and then using the min object to get the minimum value of the two waves we get a triangle. I’ve multiplied it by two to put it back to the zero to one scale. This triangle wave then gets used to control the delay speed of a variable delay, the idea being that as the delayed signal mixes with the original there will be a comb filtering effect. The speed of the phasor controls how fast the swooshing happens and the length of the delay controls the depth.</p>

<p>I’ve added in a tabwrite and an array so you can see the triangle wave as well as putting the Karplus-Strong string synth from previously to show how it all sounds on something that isn’t noise.</p>

<p>And that’s all for tonight I’m afraid. I hope to take this Patch-a-Day month out on a high my covering the Mandlebrot stuff but I’ll have to see how much I can learn about what I need tomorrow.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/11/27/patch-a-day-month-day-27-fft-based-pitch-shift-and-time-freeze/">Patch-a-Day Month Day 27: FFT Based Pitch Shift and Time Freeze</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-11-27T18:22:23+00:00" pubdate data-updated="true">Nov 27<span>th</span>, 2010</time>
        
         | <a href="/blog/2010/11/27/patch-a-day-month-day-27-fft-based-pitch-shift-and-time-freeze/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Following on from yesterdays two useful FFT based patches, I have another two for you today. The first is actually really simple but quite useful, an pitch shifter that will shift sounds you send through it up. It’s definitely not clean or accurate but it could well make for some cool patches when combined with other things.</p>

<p>The second is a time freezer patch. This has quite a bit in common with the granular synth stuff from before but this time we’re replaying a block of FFT data. It’s possibly more interesting just to see the implementation, which is by no means necessarily the right way to do this, but it works pretty well.</p>

<p><img src="/a/2010-11-27-patch-a-day-month-day-27-fft-based-pitch-shift-and-time-freeze/27-FFTDirtyShift.png" alt="A basic pitch shifter based on FFT" /></p>

<p>The main patch of the pitch shifter is really very basic. The only change is that we have a number box getting 128 added to it, going through an int to make sure it’s a whole number and then being passed to a shift object. This patch works by using a very short delay to shift the frequency bins along so that lower bins take the place of higher bins. The +128 is there because the effect doesn’t start happening untill the delay is a minimum of 128 samples. I think this might be to do with the minimum delay allowed by delay objects in PD but I’m really not sure.</p>

<p><img src="/a/2010-11-27-patch-a-day-month-day-27-fft-based-pitch-shift-and-time-freeze/27-FFTDirtyShiftSubPatch.png" alt="FFT based pitch shifter internals" /></p>

<p>Really all that is happening here is that the FFT data is delayed going into the inverse FFT object. By delaying by values that are less than a blocksize length we get a shifting up effect.</p>

<p>The time freeze has much more going on with it. What we need to do is store a block of FFT data and continuously replay this back through the inverse fft object. I chose to do this using a tabwrite~ that records the sample block when the freeze is turned on and then switches the input to the inverse fft to be a pair of tabreceive~ objects.</p>

<p><img src="/a/2010-11-27-patch-a-day-month-day-27-fft-based-pitch-shift-and-time-freeze/27-FFTTimeFreezeSubPatch.png" alt="FFT based Time Freeze sub patch" /></p>

<p>When the freeze is turned on the sel 1 will bang the tabwrites to record the FFT block. The second toggle chooses between the normal signal or the tabreceives. pretty simple but quite effective.</p>

<p><img src="/a/2010-11-27-patch-a-day-month-day-27-fft-based-pitch-shift-and-time-freeze/27-FFTTimeFreeze.png" alt="FFT based Time Freeze" /></p>

<p>The main patch is just using a variable delay to turn the freeze on a bit after the FM synth triggers are clicked. Click them once to play the first half of the FM tone and then again to stop the freeze and get the tail run off. On it’s own this isn’t so great but it’s a basic building block of lots of interesting stuff. I plan to implement some stuff like this in the Granular Synth once I get a chance.</p>

<p>Anyway, the patches can be downloaded here for people that want them.</p>

<p><a href="/a/2010-11-27-patch-a-day-month-day-27-fft-based-pitch-shift-and-time-freeze/27-FFTPitchShiftandFreeze.zip">FFT based pitch shift and time freeze</a></p>

<p>I think for the last three days of Patch-a-day I’m just going to do some basic tutorials on Pure Data specifics. For example, how to use abstractions effectively, and some of the useful GUI stuff that it does. Depends a bit on how much time I have tomorrow I think.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/11/27/patch-a-day-month-day-26-fast-fourier-transform-finished/">Patch-a-Day Month Day 26: FFT Based EQ and Delay</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-11-27T01:26:42+00:00" pubdate data-updated="true">Nov 27<span>th</span>, 2010</time>
        
         | <a href="/blog/2010/11/27/patch-a-day-month-day-26-fast-fourier-transform-finished/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Finally, I have some interesting FFT based patches for you, and they’re pretty cool as it happens. Full disclosure, these are pretty much lifted from the <a href="http://www.pd-tutorial.com/english/ch03s08.html">Fourier Analysis</a> section on <a href="http://www.pd-tutorial.com">PD-Tutorial</a> which is really worth a good read. These are the two things that interested me the most because they make all sorts of interesting sounds. I’ll be including the patches so you can down load and investigate.</p>

<p>First up, a graphical EQ using the Fourier Transform to split the incoming signal into multiple frequency bands. The blocksize used is 512 so we have 256 frequency bands to play with. All that we need to do is create an array of 256 values and and then use a tabreceive~ to pull the data out of the EQ array and multiply the frequency data.</p>

<p><img src="/a/2010-11-27-patch-a-day-month-day-26-fast-fourier-transform-finished/26-FFTGraphicEQ.png" alt="A Fourier transform based Graphical EQ" /></p>

<p>Here you can see the main patch with the EQ array, which I’ve cleaned it up a bit so the enveloping and FFT stuff are in subpatches. There’s a noise source and I’ve also used some of the FM synthesis stuff from a patch earlier this month. Here’s the subpatch doing the FFT parts but there’s really not much of a change.</p>

<p><img src="/a/2010-11-27-patch-a-day-month-day-26-fast-fourier-transform-finished/26-FFTGraphicEQSubPatch.png" alt="FFT based Graphical EQ internals" /></p>

<p>It literally is as simple as that! I think it’s worth spending a moment to point out how the multiplying together of the audio data happens here however.</p>

<p>The data out of the FFT is, as far as PD is really concerned, exactly the same as all the rest of the audio data. The blocksize in this subpatch is bigger, but all PD sees is a block of 512, floating point values between 1 and -1. The tabreceive~ object will continuously read a block of data from the EQ array, which in this case will be 256 values between 0 and 1 and then the last 256 of just 0 since the array isn’t that big. PD will multiply these two blocks together sample by sample, so that the values from our EQ array will change the correct frequency bins.</p>

<p>So with that bit of basics explained, have a look at the spectral delay. This is very simple as well, the only control is delay time, no feedback or dry/wet but it’s really not hard to add them in if you want.</p>

<p><img src="/a/2010-11-27-patch-a-day-month-day-26-fast-fourier-transform-finished/26-FFTSpectralDelay.png" alt="FFT based Spectral Delay" /></p>

<p>The main part of the patch looks almost exactly the same as the graphical EQ, the only differences being that the big array is now called Delay, and it’s values go between 0 and 100. the subpatch is where the new magic happens.</p>

<p><img src="/a/2010-11-27-patch-a-day-month-day-26-fast-fourier-transform-finished/26-FFTSpectralDelaySubPatch.png" alt="FFT based Spectral Delay internals" /></p>

<p>The data output from the initial Fourier Transform is written to two delay lines, one for each data stream. The tabreceive this time reads the data from the tab, but it then runs it through some basics maths. We are using it to control the variable delay for each frequency bin, but we want to be making sure that the data for a given frequency bin stays in that frequency bin, otherwise we will get pitch shifting (which could be cool but it’s not what we’re after right now).</p>

<p>To do this we make sure that the value is a whole integer by using wrap~ to get the decimal value of the signal and subtract this from the original number. By then multiplying by 512 we make sure that the delay is always delaying the data to the correct point in a later window. Finally, we can divide by the samplerate to get the delay time in seconds and multiply by 1000 to get the delay in milliseconds (here it’s just done in one step). This data is passed to the variable delay objects which then pass it out to the inverse Fourier transform.</p>

<p>Both the patches can be downloaded</p>

<p><a href="/a/2010-11-27-patch-a-day-month-day-26-fast-fourier-transform-finished/26-FFTEQandDelay.zip">FFT based EQ and Spectral Delay patches</a></p>

<p>I recommend extending them as you see fit, there’s loads of scope for cool sound making here. Tomorrow I’m going to try and make an FFT based freeze effect and a basic pitch shifter. After that I think I’ll leave the FFT stuff which gives me three days to fill with something interesting until the end of Patch-a-day month. I’ll ponder it later.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/11/25/patch-a-day-month-day-25-fast-fourier-transform-finished/">Patch-a-Day Month Day 25: Fast Fourier Transform Finished</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-11-25T22:56:04+00:00" pubdate data-updated="true">Nov 25<span>th</span>, 2010</time>
        
         | <a href="/blog/2010/11/25/patch-a-day-month-day-25-fast-fourier-transform-finished/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Right, this will be the last post in patch-a-day month detailing the ins and outs of the Fourier transform. After this I’m just going to carry on building the patches assuming you can deal with FFT in Pure Data, feel free to ask questions if there are still things that aren’t clear tho.</p>

<p>I’m planning on collecting the content of these articles into one big “FFT How-To” because I feel that the other FFT articles around the internet don’t get the right balance between the maths, the audio and how it actually works. Maybe I’m wrong and I won’t write anything useful but we’ll see.</p>

<p>Last night I mentioned that we would want to change the block size and overlap the Hanning windows and tonight I’m actually going to show how to do that. Pure Data itself actually handles both of the above things itself with very little effort from us which is nice. To change the blocksize we use for the FFT we actually have to change the whole blocksize being used, which sounds tricky, but actually is done using the block~ object. We create a subpatch and put a block~ object inside and with the first argument we can specify what we want the blocksize to be, bearing in mind it has to be a power of 2. I’m going to be using 512 here.</p>

<p>The block object is also responsible for doing the envelope overlapping and we can specify how many envelopes we want to have with the second argument in the block object. I’ll be using 4 overlapping envelopes in this patch. Once we have a subpatch with the block, we just move the Fourier transform stuff into the subpatch and everything works.</p>

<p><img src="/a/2010-11-25-patch-a-day-month-day-25-fast-fourier-transform-finished/25-FFTAnlysisSubpatch.png" alt="Fourier Analysis Subpatch with larger blocksize and enveloping" /></p>

<p>So there are three things to point out here, one is that we’re actually just doing the inverse transform straight away. I’m not doing any processing of the Fourier data, just turning it straight back into audio for the moment.</p>

<p>The second is that the output is also being enveloped again.</p>

<p>The third is that there’s a divide by 768 there which possibly isn’t expected. This is there to normalise the output of the transform and also to counteract the increase due to the overlapping of the envelopes. The output of the Transform will always have a gain increase equal to the blocksize. in this case we need to divide by 512 because that’s our blocksize. With four overlapping envelopes we have an increase in gain 1.5, so to normalise the outgoing audio back to the same volume as the incoming we can just divide by (512 * 1.5) = 768.</p>

<p>If you want to see that the output is the same as the input then here is the full patch.</p>

<p><img src="/a/2010-11-25-patch-a-day-month-day-25-fast-fourier-transform-finished/25-FFTFinished.png" alt="Complete FFT example patch" /></p>

<p>It’s actually possible here to see the delay caused by doing the transform if you look at the offset between the waves in the bottom panes.</p>

<p>I’ll leave that there for tonight so that these three posts stand alone as a tutorial of sorts. Tomorrow I’ll get to some of the cool things you can do with this and hopefully we can just hit the ground running.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/11/25/patch-a-day-month-day-24-fast-fourier-transform-continued/">Patch-a-Day Month Day 24: Fast Fourier Transform Continued</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-11-25T00:01:10+00:00" pubdate data-updated="true">Nov 25<span>th</span>, 2010</time>
        
         | <a href="/blog/2010/11/25/patch-a-day-month-day-24-fast-fourier-transform-continued/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Today I’m going to be getting to grips with the idea of windowing when doing FFT processing in Pure Data as well as an example of how we can better view the data we get from the FFT objects. There’s going to be a bit of maths and theory sprinkled in as well here again but I’m hoping it should just continue to clarify things.</p>

<p>It should also be noted that I fully expect to be making mistakes in all of this, my understanding of some of it is still shaky so if you spot errors or have questions, please ask. I’m still doing this patch-a-day month for my own benefit as well so having people pick me up on things is welcome.</p>

<p>The first thing I’m going to do is go back to the Complex numbers theory but this time to try and explain why we use them in signal processing. I’m going to be pointing to a few more pages on Wikipedia here so that those who want a deeper understanding can go digging. None of this will be very scary if you can manage basic trigonometry, and it’s not strictly necessary to understand all of it, but it’s probably better to know it than not.</p>

<p>A complex number is just a number with a real and imaginary part, 3 + 2i for example. We can plot these on an <a href="http://en.wikipedia.org/wiki/Complex_plane">Argand diagram</a> which is really just an XY grid where the X axis is the real numbers (3,2,1,0,-1,-2 etc) and the Y axis is the imaginary numbers (3i, 2i, 1i, 0, -1i -2i, etc). When a complex number is plotted on the diagram we can imagine it as a triangle in the same way that any other XY point would be and we can see that there is a length associated with it as well as an angle.</p>

<p>For example, on the below diagram we have plotted the complex number -3 + 4i.</p>

<p>Simple trig will tell us that the distance between the number and the origin is root (3^2 + 4^2) = 5 and that the angle theta will be sin-1(4/5) roughly equals 53.1. If I now say that by representing a signal as a complex number we can plot it on an Argand diagram, that the length corresponds to the magnitude of that signal and the angle theta corresponds to its phase shift, hopefully you can see why this starts becoming interesting.</p>

<p>At this point I feel I should point out the formula of <a href="http://en.wikipedia.org/wiki/Euler's_formula">Euler</a> and <a href="http://en.wikipedia.org/wiki/De_Moivre's_formula">de Moivre</a>, which are pretty much the basis of the above link. I don’t want to go too deep here (mostly because the maths is only half remembered) but the eventual end point is that a signal can be represented as an exponential function which, when expanded ends up as a series of complex numbers with Sin and Cos terms. I’m hoping that all this has fallen into place somewhat because if you’ve got it then you pretty much understand all we need to know for this.</p>

<p>Things should get even clearer when I say that what our rfft~ object is actually spitting out are these pairs of Sin and Cos values. This means that we can go back and modify our previous patch and we can get accurate data to show us the magnitude and phase of all our frequency bins.</p>

<p><img src="/a/2010-11-25-patch-a-day-month-day-24-fast-fourier-transform-continued/24-FFTContinued-1.png" alt="FFT Patch correctly displaying Magnitude and Phase data" /></p>

<p>It’s worth pointing out quickly that I’m using the atan~ object from the cyclone library to calculate the phase data here because otherwise there’s just too much fiddly coding to get what we need. To try and show this all a little better I’ve modified it further so that the phase of the oscillator can be changed and the range on the graphs is a little clearer.</p>

<p><img src="/a/2010-11-25-patch-a-day-month-day-24-fast-fourier-transform-continued/24-FFTContinued-2.png" alt="Further modified FFT patch to show phase data more clearly" /></p>

<p>The final thing I will talk about tonight is the idea of windowing and the reasons for it. I’ve already talked about it and used it with the granular synth so this shouldn’t have any surprises. If you look at the frequency plot when you have a frequency that should fit exactly in the bins you can see it spilling over into other bins somewhat. This is because when we pull our 64 bits of data out to analyse we are adding other harmonics into it due to the clipping. The example to give here is that of a square wave, which has many more harmonics than a sine wave. Because we may be taking a sample that is midway through a waveform, we are probably clipping that waveform off at a non zero value, which leads to square wave like edges at the start and end of our sample which can add other harmonics in.</p>

<p>To help counteract this we can envelope the samples as we take them in to smooth off these edges.</p>

<p><img src="/a/2010-11-25-patch-a-day-month-day-24-fast-fourier-transform-continued/24-FFTWithHannWindow.png" alt="FFT Analysis patch with Hanning Window" /></p>

<p>The envelope is exactly one cycle of a sin wave, offset by one and this time it fits into 64 samples, our blocksize. The tabreceive~ object reads exactly one block of data out, matching the 64 sample length, and modulates the output of the oscillator with it. Every block that the rfft object now reads will start and end with a zero value.</p>

<p>Unfortunately, this form of amplitude modulation introduces it’s own forms of distortion, volume loss and problems with fast transients. The answer to this is to have overlapping windows that are analysed. Unfortunately, this is going to need to be covered tomorrow as I am now tired and sleepy and wish to go to bed.</p>

<p>I’ve realised that I haven’t really done much that I would consider to be in keeping with Patch-a-day today and yesterday so I’m considering extending the month by a couple of days and then doing my learning properly and writing this FFT stuff up as a proper tutorial. I’ll let you know, but right now, crash time.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/11/23/patch-a-day-month-day-23-fast-fourier-transform-introduction/">Patch-a-Day Month Day 23: Fast Fourier Transform Introduction</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-11-23T23:23:38+00:00" pubdate data-updated="true">Nov 23<span>rd</span>, 2010</time>
        
         | <a href="/blog/2010/11/23/patch-a-day-month-day-23-fast-fourier-transform-introduction/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>OK, so today’s entry is going to get a bit heavy on the maths so due warning for those who might not think they’re so hot with it. In truth, I’m having to try and dredge an embarrassing amount of knowledge up from my memory. It feels like a long time since learning about this at uni but it’s really not, which just shows what happens if you don’t use your knowledge. This post will be mostly writing with not so many pictures.</p>

<p>All this possible pain is worth it, however, as being able to use the Fourier transform opens up the possibilities for lots of things. I’m going to be referencing a lot of other material here as I don’t want to be having to go in depth on things that other people have explained better than me. I will start off with a collection of some of the more important terms and then have a small patch to try and help explain. I’ll start on interesting patches tomorrow, learning to do first.</p>

<p>So the idea of the Fourier Transform is that we take a section of samples from a signal and break it down into the frequency components that are present. The sections all have to have a number of samples in them equal to a power of two due to how the maths works. In PureData by default the audio signals are calculated in blocks of 64. So we can pass these blocks one after the other into our patch, analyse the frequencies in that audio and then process it.</p>

<p>A few terms that will keep cropping up:-</p>

<ol>
  <li>
    <p>Nyquist frequency</p>
  </li>
  <li>
    <p>Block size</p>
  </li>
  <li>
    <p>Imaginary/complex numbers</p>
  </li>
  <li>
    <p>Frequency bin</p>
  </li>
</ol>

<p>The Nyquist frequency is the maximum frequency that we can analyse. In digital audio, the maximum frequency that you can playback is half of the sampling frequency. Our sample rate is the standard 44.1 KHz, so our Nyquist frequency is 22.05 KHz. For more of an explanation <a href="http://en.wikipedia.org/wiki/Nyquist_frequency">Wikipedia gives a good run-down</a>.</p>

<p>The block size is how many samples we’re analysing in one go which, as said is 64 by default. Given our sampling frequency this corresponds to about one and a half milliseconds of audio. We will want to change this later on for reasons that will soon become clear.</p>

<p>Imaginary numbers are not really as scary as some might believe. If you can understand XY co-ordinates on 2D graphs and do simple trigonometry then you can deal with imaginary numbers. These are important in Fourier analyses because a frequency doesn’t just have a magnitude, but a phase as well. Imaginary numbers are used to represent a harmonic with a particular volume and phase offset from the other harmonics. Pure Data’s FFT objects actually give this info out in the form of sin and cos components. This means that a harmonic can be represented as a sin wave component (real part) and a cos wave component (imaginary part). For more information, start at the <a href="http://en.wikipedia.org/wiki/Imaginary_numbers">Imaginary Numbers page</a> on Wikipedia and go get lost in maths for an hour or two.</p>

<p>The Frequency bins are what we actually get out when we do a Fourier transform, or more specifically, we get a “list of magnitudes for the real and imaginary components of a number of frequency bins equal to the number of samples we are analysing”. The first thing to point out is that if we have a block size of 64 samples, then we get a list of 64 values that give the real magnitudes and 64 that give the imaginary magnitudes. These 64 values actually represent a frequency band because the bins are distributed evenly between 0Hz and the Nyquist frequency. With a block size of 64 samples each frequency bin accounts for a range of about 350 Hz, so by changing the block size we can get a more accurate measurement.</p>

<p>It should be pointed out that harmonics that would fall between the frequency bins will be smeared across multiple bins which makes analysis that much harder. All the more reason to use a bigger block size. Of course it’s also worth pointing out two more shortcomings. Firstly, the Fourier transform can only accurately measure frequencies where an entire waveform will fit within the block. With our block size of 64 samples, the lowest frequency we can accurately measure is about 690Hz. If we upped the block size to 512 for example then the lowest frequency goes down to about 90Hz. The problem with just making a bigger block size is that it introduces a delay. We have to wait for all of those samples to come to us before we can analyse them which with a block size of 512 means there will be at least an 11 millisecond delay from the first sample being played to the last sample getting analysed. Maybe not so bad but it’s worth bearing in mind.</p>

<p>Parts of the above are a bit of a simplification so far but this should be enough to get up and going. I’m going to create a page for PureData resources to go along with the other pages I have on this site and I’ll be pointing out stuff that explains Fourier Transforms better than I do.</p>

<p>So, onto a basic patch, this is purely to show you what sort of an output we get from the FFT objects. Hopefully that will suffice and I’ve given you enough to mull on until tomorrow.</p>

<p><img src="/a/2010-11-23-patch-a-day-month-day-23-fast-fourier-transform-introduction/23-FFTIntro.png" alt="Fast Fourier Transform introduction patch" /></p>

<p>So here we can feed a signal at a chosen frequency into the FFT object. It can either be a freely chosen frequency, or we can pick a frequency that exactly matches one of the frequency bins. The above picture shows a matching frequency which is why there are the exact values for the frequency bins. There may be some confusion as to why there are actually two peaks/troughs on each graph. This is because the Fourier Transform actually gives out twice as many frequency bins as the number of samples we give it but these are actually mirrored about the Nyquist frequency, meaning the upper half aren’t any use to us. The rfft~ object will actually get rid of this data and only calculate the parts we want which results in much less CPU loading.</p>

<p>I recommend building the patch and having a play so you can see how the frequencies get smeared when they’re not a perfect harmonic. Like I said, there’s very little here in the way of a patch tonight but it’s necessary to get the rest of what’s happening.</p>

<p>I’ll leave it here now. Tomorrow will still be involving a bit of theory but if you’ve grasped what’s here it shouldn’t be too hard.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/11/22/patch-a-day-month-day-22-granular-synth-with-grain-randomisation/">Patch-a-Day Month Day 22: Granular Synth With Grain Randomisation</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-11-22T21:06:17+00:00" pubdate data-updated="true">Nov 22<span>nd</span>, 2010</time>
        
         | <a href="/blog/2010/11/22/patch-a-day-month-day-22-granular-synth-with-grain-randomisation/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>So the granular synth posts continue as I build up this noisy machine. It’s nearing a state of completion now where I’ll make the patch down-loadable and put a few examples up on SoundCloud. There are a few bits and pieces that I want to do yet but I think that this will be the last Patch-a-day post about it. Don’t want to bore anybody after all.</p>

<p><img src="/a/2010-11-22-patch-a-day-month-day-22-granular-synth-with-grain-randomisation/22-GranSynthWithRand.png" alt="Granular Synth with Grain Randomisation" /></p>

<p>So I’ve spent a bit of time just cleaning up the interface, part of that has been using the receive-symbol options in all the number objects so that the loadbang and message on the right can set values for the controls when the patch loads. I’ve also pulled the LFO controls out of the sub-patch so they’re easily accessible.</p>

<p>The new stuff is the Rand controls and the multiple grains that are there now. The GrainPlayer abstraction now has randomising functionality on a per-grain basis. This means that when randomised the grains will be playing slightly different sample sections at slightly different speeds which results in a very interesting sound. This is implemented in a similar way to the LFOs.</p>

<p><img src="/a/2010-11-22-patch-a-day-month-day-22-granular-synth-with-grain-randomisation/22-GrainPlayerWithRand.png" alt="Grain Player with Parameter Randomisation" /></p>

<p>The grain speed and grain start parameters are both being modified but this time our source is a noise~ object. When the startRand or speedRand buttons are pressed we take a snapshot of the noise, this gets multiplied by 0.9 to set the absolute limits, then multiplied by the modulation amount and finally offset to centre around a value of one. This results in all our grains having a differing value for their speed and/or grain starting position, but all centring around the chosen global value.</p>

<p>Playing around with this it’s pretty easy to get some dense sounding grain clouds, even with only the six grains currently there. I’m planning on adding a similar system to this for stereo panning to get some spread amongst the grains, probably with some LFO modulation as well. I’d like to have some per-grain LFOs as well thinking about it so that there’s the possibility to have different grains coming in and out of the sound. Maybe it’s worth looking at some frequency modulation of grains? I’ll investigate at some point.</p>

<p>One of the things I definitely want to add is the ability to globally change the start position of the grains so as to move through the sample. It shouldn’t be difficult to do and will result in there being the ability to have more obvious movement. Either way, I’ll be leaving the granular synthesis out of Patch-a-day month for now and just put stuff up here once it’s done.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/11/22/attempting-to-use-feedburner/">Attempting to Use FeedBurner</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-11-22T12:31:07+00:00" pubdate data-updated="true">Nov 22<span>nd</span>, 2010</time>
        
         | <a href="/blog/2010/11/22/attempting-to-use-feedburner/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>As it says above, I’m testing this out to see if it’s any better than the current Wordpress feed stats plugin I have. Hopefully it is and everything goes smoothly…..</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/9/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/page/7/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2012/09/11/cuttr-is-now-live-and-running/">Cuttr is now live and running</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/08/30/programming-is-good-for-the-soul/">Programming is good for the soul</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/07/08/organising-domains-and-migrating-sites/">Organising Domains and migrating sites</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/06/30/glitchr-up-and-running/">Glitchr up and running</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/06/24/octopress-customisation/">Octopress Customisation</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/rumblesan">@rumblesan</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'rumblesan',
            count: 5,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("rumblesan", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/rumblesan" class="twitter-follow-button" data-show-count="false">Follow @rumblesan</a>
  
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - guy -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'rumblesan';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
