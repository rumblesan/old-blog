
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Patch-a-Day Month Day 26: FFT based EQ and Delay - RumbleSan Heavy Noise Industries</title>
  <meta name="author" content="guy">

  
  <meta name="description" content="Finally, I have some interesting FFT based patches for you, and they’re pretty cool as it happens. Full disclosure, these are pretty much lifted from &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://rumblesan.com/blog/2010/11/27/patch-a-day-month-day-26-fast-fourier-transform-finished/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="RumbleSan Heavy Noise Industries" type="application/atom+xml">
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
    });
</script>
<script type="text/javascript"
  src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


<!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-19842221-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">RumbleSan Heavy Noise Industries</a></h1>
  
    <h2>Noise with weight</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:rumblesan.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Home</a></li>
  <li><a href="/about">About</a></li>
  <li><a href="http://patchwerk.rumblesan.com">PatchWerk</a></li>
  <li><a href="http://rumblesan.tumblr.com">Glitchr</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Patch-a-Day Month Day 26: FFT Based EQ and Delay</h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-11-27T01:26:42+00:00" pubdate data-updated="true">Nov 27<span>th</span>, 2010</time>
        
         | <a href="#disqus_thread">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>Finally, I have some interesting FFT based patches for you, and they’re pretty cool as it happens. Full disclosure, these are pretty much lifted from the <a href="http://www.pd-tutorial.com/english/ch03s08.html">Fourier Analysis</a> section on <a href="http://www.pd-tutorial.com">PD-Tutorial</a> which is really worth a good read. These are the two things that interested me the most because they make all sorts of interesting sounds. I’ll be including the patches so you can down load and investigate.</p>

<p>First up, a graphical EQ using the Fourier Transform to split the incoming signal into multiple frequency bands. The blocksize used is 512 so we have 256 frequency bands to play with. All that we need to do is create an array of 256 values and and then use a tabreceive~ to pull the data out of the EQ array and multiply the frequency data.</p>

<p><img src="/a/2010-11-27-patch-a-day-month-day-26-fast-fourier-transform-finished/26-FFTGraphicEQ.png" alt="A Fourier transform based Graphical EQ" /></p>

<p>Here you can see the main patch with the EQ array, which I’ve cleaned it up a bit so the enveloping and FFT stuff are in subpatches. There’s a noise source and I’ve also used some of the FM synthesis stuff from a patch earlier this month. Here’s the subpatch doing the FFT parts but there’s really not much of a change.</p>

<p><img src="/a/2010-11-27-patch-a-day-month-day-26-fast-fourier-transform-finished/26-FFTGraphicEQSubPatch.png" alt="FFT based Graphical EQ internals" /></p>

<p>It literally is as simple as that! I think it’s worth spending a moment to point out how the multiplying together of the audio data happens here however.</p>

<p>The data out of the FFT is, as far as PD is really concerned, exactly the same as all the rest of the audio data. The blocksize in this subpatch is bigger, but all PD sees is a block of 512, floating point values between 1 and -1. The tabreceive~ object will continuously read a block of data from the EQ array, which in this case will be 256 values between 0 and 1 and then the last 256 of just 0 since the array isn’t that big. PD will multiply these two blocks together sample by sample, so that the values from our EQ array will change the correct frequency bins.</p>

<p>So with that bit of basics explained, have a look at the spectral delay. This is very simple as well, the only control is delay time, no feedback or dry/wet but it’s really not hard to add them in if you want.</p>

<p><img src="/a/2010-11-27-patch-a-day-month-day-26-fast-fourier-transform-finished/26-FFTSpectralDelay.png" alt="FFT based Spectral Delay" /></p>

<p>The main part of the patch looks almost exactly the same as the graphical EQ, the only differences being that the big array is now called Delay, and it’s values go between 0 and 100. the subpatch is where the new magic happens.</p>

<p><img src="/a/2010-11-27-patch-a-day-month-day-26-fast-fourier-transform-finished/26-FFTSpectralDelaySubPatch.png" alt="FFT based Spectral Delay internals" /></p>

<p>The data output from the initial Fourier Transform is written to two delay lines, one for each data stream. The tabreceive this time reads the data from the tab, but it then runs it through some basics maths. We are using it to control the variable delay for each frequency bin, but we want to be making sure that the data for a given frequency bin stays in that frequency bin, otherwise we will get pitch shifting (which could be cool but it’s not what we’re after right now).</p>

<p>To do this we make sure that the value is a whole integer by using wrap~ to get the decimal value of the signal and subtract this from the original number. By then multiplying by 512 we make sure that the delay is always delaying the data to the correct point in a later window. Finally, we can divide by the samplerate to get the delay time in seconds and multiply by 1000 to get the delay in milliseconds (here it’s just done in one step). This data is passed to the variable delay objects which then pass it out to the inverse Fourier transform.</p>

<p>Both the patches can be downloaded</p>

<p><a href="/a/2010-11-27-patch-a-day-month-day-26-fast-fourier-transform-finished/26-FFTEQandDelay.zip">FFT based EQ and Spectral Delay patches</a></p>

<p>I recommend extending them as you see fit, there’s loads of scope for cool sound making here. Tomorrow I’m going to try and make an FFT based freeze effect and a basic pitch shifter. After that I think I’ll leave the FFT stuff which gives me three days to fill with something interesting until the end of Patch-a-day month. I’ll ponder it later.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">guy</span></span>

      








  


<time datetime="2010-11-27T01:26:42+00:00" pubdate data-updated="true">Nov 27<span>th</span>, 2010</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/music/'>Music</a>, <a class='category' href='/blog/categories/patch-a-day/'>Patch-A-Day</a>, <a class='category' href='/blog/categories/pure-data/'>Pure Data</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2010/11/25/patch-a-day-month-day-25-fast-fourier-transform-finished/" title="Previous Post: Patch-a-Day Month Day 25: Fast Fourier Transform Finished">&laquo; Patch-a-Day Month Day 25: Fast Fourier Transform Finished</a>
      
      
        <a class="basic-alignment right" href="/blog/2010/11/27/patch-a-day-month-day-27-fft-based-pitch-shift-and-time-freeze/" title="Next Post: Patch-a-Day Month Day 27: FFT based Pitch Shift and Time Freeze">Patch-a-Day Month Day 27: FFT based Pitch Shift and Time Freeze &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2012/09/11/cuttr-is-now-live-and-running/">Cuttr is now live and running</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/08/30/programming-is-good-for-the-soul/">Programming is good for the soul</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/07/08/organising-domains-and-migrating-sites/">Organising Domains and migrating sites</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/06/30/glitchr-up-and-running/">Glitchr up and running</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/06/24/octopress-customisation/">Octopress Customisation</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/rumblesan">@rumblesan</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'rumblesan',
            count: 5,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating...</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("rumblesan", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/rumblesan" class="twitter-follow-button" data-show-count="false">Follow @rumblesan</a>
  
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - guy -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'rumblesan';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://rumblesan.com/blog/2010/11/27/patch-a-day-month-day-26-fast-fourier-transform-finished/';
        var disqus_url = 'http://rumblesan.com/blog/2010/11/27/patch-a-day-month-day-26-fast-fourier-transform-finished/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
